<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS 保存和读取本地数据 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文记录了如何将iOS app中的数据,如图片和实例中的属性保存到本地,应用退出或者切换状态后,能够重新恢复数据">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS 保存和读取本地数据">
<meta property="og:url" content="http://yoursite.com/2015/06/07/2015-06-07-ios-saving-loading-local-data/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="本文记录了如何将iOS app中的数据,如图片和实例中的属性保存到本地,应用退出或者切换状态后,能够重新恢复数据">
<meta property="og:updated_time" content="2015-06-09T14:16:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS 保存和读取本地数据">
<meta name="twitter:description" content="本文记录了如何将iOS app中的数据,如图片和实例中的属性保存到本地,应用退出或者切换状态后,能够重新恢复数据">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2015-06-07-ios-saving-loading-local-data" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/07/2015-06-07-ios-saving-loading-local-data/" class="article-date">
  <time datetime="2015-06-06T16:00:00.000Z" itemprop="datePublished">2015-06-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iOS 保存和读取本地数据
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="类要遵循的[protocol]和实现的methods_(id:top)">类要遵循的[protocol]和实现的methods  (id:top)</h3><blockquote>
<blockquote>
<p>要想将一个object中的property保存到本地, 这个object的对应的class应该遵循 NSCoding协议, 并实现其2个methods: </p>
</blockquote>
</blockquote>
<ul>
<li>NSCoding protocol</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@interface</span> <span class="string">BNRItem :</span> NSObject &lt;NSCoding&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>encodeWIthCoder </li>
</ul>
<p>将class中的property以key-value的形式进行encode, 并将数据流存储到本地的文件系统中, 其中key设定为property的名称.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="typename">void</span>)<span class="string">encodeWithCoder:</span>(NSCoder *)aCoder&#123;</span><br><span class="line">    </span><br><span class="line">    [aCoder <span class="string">encodeObject:</span>self.itemName <span class="string">forKey:</span>@<span class="string">"itemName"</span>];</span><br><span class="line">    [aCoder <span class="string">encodeObject:</span>self.serialNumber <span class="string">forKey:</span>@<span class="string">"serialNumber"</span>];</span><br><span class="line">    [aCoder <span class="string">encodeObject:</span>self.dateCreated <span class="string">forKey:</span>@<span class="string">"dateCreated"</span>];</span><br><span class="line">    [aCoder <span class="string">encodeObject:</span>self.itemKey <span class="string">forKey:</span>@<span class="string">"itemKey"</span>];</span><br><span class="line">    [aCoder <span class="string">encodeInt:</span>self.valueInDollars <span class="string">forKey:</span>@<span class="string">"valueInDollars"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>initWithCoder </li>
</ul>
<p>从encodeWithCoder中的数据中, 恢复数据, 并赋值给各个property,</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (id)<span class="string">initWithCoder:</span>(NSCoder *)aDecoder&#123;</span><br><span class="line">    self = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (self) &#123;</span><br><span class="line">        _itemName = [aDecoder <span class="string">decodeObjectForKey:</span>@<span class="string">"itemName"</span>];</span><br><span class="line">        _serialNumber = [aDecoder <span class="string">decodeObjectForKey:</span>@<span class="string">"serialNumber"</span>];</span><br><span class="line">        _dateCreated = [aDecoder <span class="string">decodeObjectForKey:</span>@<span class="string">"dateCreated"</span>];</span><br><span class="line">        _itemKey = [aDecoder <span class="string">decodeObjectForKey:</span>@<span class="string">"itemKey"</span>];</span><br><span class="line">        _valueInDollars = [aDecoder <span class="string">decodeIntForKey:</span>@<span class="string">"valueInDollars"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="选定保存数据的路径和目录">选定保存数据的路径和目录</h3><p>每一个应用都有其对应的sandbox, 只有本身可以访问,与其他app隔离, sandbox包含的目录有:</p>
<ul>
<li><p>application bundle: 只读, NIB和图标等文件</p>
</li>
<li><p>Documents/: 存储的文件, 可用iCloud备份;</p>
</li>
<li><p>Library/Caches/: 缓存的文件, 不能备份;</p>
</li>
<li><p>Library/Preferences/: app的setting等设置</p>
</li>
<li><p>tmp/ : 临时文件, 注意其清理</p>
</li>
</ul>
<p>查找Document/的目录代码并指定保存的文件名称:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (NSString *) itemArchivePath &#123;</span><br><span class="line">   NSArray *documentDirs =  NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</span><br><span class="line">    </span><br><span class="line">    NSString * documentDir = [documentDirs firstObject];</span><br><span class="line">    NSString *fileName = @<span class="string">"item.archive"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span>  [documentDir stringByAppendingPathComponent:fileName];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="如何开始将数据保存到本地">如何开始将数据保存到本地</h3><p>设定好要保存的property和路径后, 就需要在app进入后台的时候(双击home键), 触发保存事件.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)applicationDidEnterBackground:(UIApplication *)application</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later. </span></span><br><span class="line">    <span class="comment">// If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.</span></span><br><span class="line">    BOOL success = [[BNRItemStore sharedStore] saveChanges];</span><br><span class="line">    <span class="keyword">if</span> (success) &#123;</span><br><span class="line">        NSLog(@<span class="string">"saved all items"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        NSLog(@<span class="string">"Failed: can't sace items data!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* save changes保存的函数</span><br><span class="line">*  self.privateItems为一个数组, 里面包含了多个item</span><br><span class="line">*/</span> NSKeyedArchiver 会递归的调用数组里每一个item的 encodeWithCoder 方法</span><br><span class="line">- (BOOL) saveChanges&#123;</span><br><span class="line">    NSString * fileName = [self itemArchivePath]; </span><br><span class="line">    <span class="keyword">return</span> [NSKeyedArchiver archiveRootObject:self.privateItems toFile:fileName];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="如何将数据load到app中">如何将数据load到app中</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSString *path = [self itemArchivePath];</span><br><span class="line">_privateItems = [NSKeyedUnarchiver unarchiveObjectWithFile:path];</span><br></pre></td></tr></table></figure>
<h3 id="对于图片的保存,_可以采用NSData的writeToFile:path">对于图片的保存, 可以采用NSData的writeToFile:path</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取图片的保存目录</span></span><br><span class="line">- (NSString *)imagePathForKey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    NSArray *documentDirectories =</span><br><span class="line">            NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,</span><br><span class="line">                                                NSUserDomainMask,</span><br><span class="line">                                                YES);</span><br><span class="line">    NSString *documentDirectory = [documentDirectories firstObject];</span><br><span class="line">    <span class="keyword">return</span> [documentDirectory stringByAppendingPathComponent:key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存图片到本地</span></span><br><span class="line">NSString *imagePath = [self imagePathForKey:key];</span><br><span class="line"> <span class="comment">// Turn image into JPEG data</span></span><br><span class="line">    NSData *data = UIImageJPEGRepresentation(image, <span class="number">0.5</span>);</span><br><span class="line">    <span class="comment">// Write it to full path</span></span><br><span class="line">    [data writeToFile:imagePath atomically:YES];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取本地的图片</span></span><br><span class="line">NSString *imagePath = [self imagePathForKey:key];</span><br><span class="line"> <span class="comment">// Create UIImage object from file</span></span><br><span class="line">  result = [UIImage imageWithContentsOfFile:imagePath];</span><br></pre></td></tr></table></figure>
<p>返回<a href="#top">顶部</a></p>
<p>At 15:56 PM</p>
<h2 id="参考资料">参考资料</h2><ul>
<li>iOS Programming The Big Nerd Ranch Guide 4th Edition</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/06/07/2015-06-07-ios-saving-loading-local-data/" data-id="ciapcagil00086ufvpemangjw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NSCoding/">NSCoding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Object-C/">Object C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS入门/">iOS入门</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/应用状态/">应用状态</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/09/14/ios 图片的旋转动画效果/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          iOS图片的旋转动画效果
        
      </div>
    </a>
  
  
    <a href="/2015/06/02/2015-06-02-ios-url-json/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">iOS URL请求和JSON的解析</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CGAffineTransform/">CGAffineTransform</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSCoding/">NSCoding</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Object-C/">Object C</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Perl/">Perl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Variable-Byte-Code/">Variable Byte Code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wicked-Cool-Shell-Scripts/">Wicked Cool Shell Scripts</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anchorPoint/">anchorPoint</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS入门/">iOS入门</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pages/">pages</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tech/">tech</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vmware/">vmware</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webView/">webView</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/压缩/">压缩</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/可变字节码/">可变字节码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/应用状态/">应用状态</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/输入验证/">输入验证</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/CGAffineTransform/" style="font-size: 10px;">CGAffineTransform</a> <a href="/tags/NSCoding/" style="font-size: 10px;">NSCoding</a> <a href="/tags/Object-C/" style="font-size: 20px;">Object C</a> <a href="/tags/Perl/" style="font-size: 10px;">Perl</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Variable-Byte-Code/" style="font-size: 10px;">Variable Byte Code</a> <a href="/tags/Wicked-Cool-Shell-Scripts/" style="font-size: 10px;">Wicked Cool Shell Scripts</a> <a href="/tags/anchorPoint/" style="font-size: 10px;">anchorPoint</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/iOS入门/" style="font-size: 20px;">iOS入门</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/pages/" style="font-size: 10px;">pages</a> <a href="/tags/tech/" style="font-size: 20px;">tech</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/vmware/" style="font-size: 10px;">vmware</a> <a href="/tags/webView/" style="font-size: 10px;">webView</a> <a href="/tags/压缩/" style="font-size: 10px;">压缩</a> <a href="/tags/可变字节码/" style="font-size: 10px;">可变字节码</a> <a href="/tags/应用状态/" style="font-size: 10px;">应用状态</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/输入验证/" style="font-size: 10px;">输入验证</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/09/14/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2015/09/14/ios 图片的旋转动画效果/">iOS图片的旋转动画效果</a>
          </li>
        
          <li>
            <a href="/2015/06/07/2015-06-07-ios-saving-loading-local-data/">iOS 保存和读取本地数据</a>
          </li>
        
          <li>
            <a href="/2015/06/02/2015-06-02-ios-url-json/">iOS URL请求和JSON的解析</a>
          </li>
        
          <li>
            <a href="/2014/05/09/2014-05-09-valid-input-with-shell/">Shell对输入参数的验证</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>